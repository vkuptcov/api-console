<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-tabs/paper-tab.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../request-timings/request-timings-panel.html">
<link rel="import" href="../headers-list-view/headers-list-view.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="http-source-message-view.html">
<link rel="import" href="status-message.html">


</head><body><dom-module id="response-status-view">
  <template>
    <style>
    :host {
      @apply(--layout-vertical);
      @apply(--response-status-view);
    }

    .status-row,
    .timings-row {
      @apply(--layout-horizontal);
      @apply(--arc-font-subhead);
      @apply(--layout-center);
      min-height: 56px;
    }

    .status-row {
      border-bottom: 1px var(--response-status-view-status-info-border-color, #e5e5e5) solid;
    }

    .timings-row {
      padding-right: 0;
    }

    .status-label {
      width: 40px;
      @apply(--arc-font-subhead);
    }

    .status-value {
      @apply(--layout-flex);
      @apply(--layout-horizontal);
      @apply(--layout-center);
      @apply(--response-status-view-status-container);
    }

    .status-value > span {
      display: block;
    }

    .status-value.status {
      padding: 0 16px;
    }

    .redirect-value {
      margin-top: 12px;
      @apply(--layout-flex);
    }

    .no-redirects-container {
      @apply(--layout-vertical);
      @apply(--layout-center);
    }

    .no-redirects-info {
      @apply(--no-info-message);
    }

    headers-list-view {
      margin-top: 12px;
    }

    .text {
      @apply(--select-text);
    }

    .badge {
      display: block;
      background-color: var(--response-status-view-badge-background, --accent-color);
      color: var(--response-status-view-badge-color, #fff);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 12px;
      margin-left: 12px;
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
    }

    .badge.empty {
      background-color: var(--response-status-view-empty-badge-background, #9e9e9e);
      color: var(--response-status-view-empty-badge-color, #fff);
    }

    .status-value.status.text > span:not(:first-child) {
      margin-left: 8px;
    }

    .status-code-value {
      padding: 4px 8px;
      color: #fff;
      border-radius: 2px;
      background-color: var(--arc-status-code-color-200, rgba(56, 142, 60, 1));
    }

    .info.status-code-value {
      background-color: var(--arc-status-code-color-300, rgba(48, 63, 159, 1));
    }

    .warning.status-code-value {
      background-color: var(--arc-status-code-color-400, rgba(245, 124, 0, 1));
    }

    .error.status-code-value {
      background-color: var(--arc-status-code-color-500, rgba(211, 47, 47, 1));
    }

    .response-time {
      color: var(--response-status-view-loading-time-color, rgba(0, 0, 0, 0.54));
      margin-left: 8px;
    }

    .status-info {
      @apply(--layout-flex);
    }

    .toggle-button {
      color: var(--response-status-view-toggle-icon-color, rgba(0, 0, 0, 0.54));
      transition: color 0.25s linear;
    }

    .toggle-icon {
      transform: rotateZ(0deg);
      transition: transform 0.3s linear;
    }

    .toggle-icon.opened {
      transform: rotateZ(-180deg);
    }

    .toggle-button:hover {
      color: var(--response-status-view-toggle-icon-hover-color, rgba(0, 0, 0, 0.78));
    }

    .xhr-title {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      padding: 0px 16px;
      @apply(--arc-font-subhead);
    }

    .redirect-location {
      margin-left: 8px;
    }

    .response-error-label {
      margin-left: 12px;
      color: var(--arc-status-code-color-500, rgba(211, 47, 47, 1));
    }
    </style>
    <div class="status-row">
      <div class="status-value status">
        <template is="dom-if" if="[[!isError]]">
          <div class="status-info text">
            <span class$="[[_computeStatusClass(statusCode)]]">[[statusCode]] [[statusMessage]]</span>
            <span class="response-time" hidden$="[[!loadingTime]]">[[_roundTime(loadingTime)]] ms</span>
          </div>
          <div class="status-details">
            <paper-button on-tap="toggleCollapse" class="toggle-button" title="Toogle response headers">
              Details
              <iron-icon icon="arc:expand-more" class$="[[_computeToggleIconClass(opened)]]"></iron-icon>
            </paper-button>
          </div>
        </template>
        <template is="dom-if" if="[[isError]]">
          <span class="error status-code-value">0</span>
          <span class="response-time" hidden$="[[!loadingTime]]">[[_roundTime(loadingTime)]] ms</span>
          <p class="response-error-label">Error in the response.</p>
        </template>
      </div>
    </div>
    <iron-collapse opened="[[opened]]">
      <template is="dom-if" if="[[!isXhr]]">
        <paper-tabs selected="{{selectedTab}}">
          <paper-tab>
            <span>Response headers</span>
            <span class$="[[_computeBageClass(responseHeaders)]]">[[_computeHeadersLength(responseHeaders)]]</span>
          </paper-tab>
          <paper-tab>
            <span>Request headers</span>
            <span class$="[[_computeBageClass(requestHeaders)]]">[[_computeHeadersLength(requestHeaders)]]</span>
          </paper-tab>
          <paper-tab>
            <span>Redirects</span>
            <span class$="[[_computeBageClass(redirects.length)]]">[[redirects.length]]</span>
          </paper-tab>
          <paper-tab>Timings</paper-tab>
        </paper-tabs>
        <iron-pages selected="[[selectedTab]]">
          <headers-list-view on-tap="_handleLink" headers="[[responseHeaders]]"></headers-list-view>
          <section class="request-header-panel">
            <headers-list-view type="request" on-tap="_handleLink" headers="[[requestHeaders]]"></headers-list-view>
            <http-source-message-view hidden$="[[!hasHttpMessage]]" message="[[httpMessage]]"></http-source-message-view>
          </section>
          <section class="redirects-panel">
            <template is="dom-if" if="[[!redirects.length]]">
              <div class="no-redirects-container">
                <p class="no-redirects-info">There were no redirects during this request</p>
              </div>
            </template>
            <template is="dom-repeat" items="[[redirects]]">
              <div class="status-row">
                <div class="status-label text">
                  #<span>[[_computeIndexName(index)]]</span>
                </div>
                <div class="redirect-value" on-tap="_handleLink">
                  <div class="status-value status text">
                    <span class$="[[_computeStatusClass(item.status)]]">[[item.status]] [[item.statusText]]</span>
                    <span class="redirect-location">to: <a href="[[_computeRedirectLocation(item.headers)]]" class="auto-link">[[_computeRedirectLocation(item.headers)]]</a></span>
                  </div>
                  <headers-list-view headers="[[item.headers]]"></headers-list-view>
                </div>
              </div>
            </template>
          </section>
          <section class="timings-panel">
            <request-timings-panel redirects="[[redirectTimings]]" timings="[[timings]]"></request-timings-panel>
          </section>
        </iron-pages>
      </template>
      <template is="dom-if" if="[[isXhr]]">
        <template is="dom-if" if="[[hasResponseHeaders]]">
          <h3 class="xhr-title">Response headers <span class$="[[_computeBageClass(responseHeaders)]]">[[_computeHeadersLength(responseHeaders)]]</span></h3>
          <headers-list-view on-tap="_handleLink" headers="[[responseHeaders]]"></headers-list-view>
        </template>
      </template>
    </iron-collapse>
  </template>
  <script>Polymer({is:"response-status-view",properties:{statusCode:{type:Number,observer:"_statusCodeChanged"},statusMessage:String,loadingTime:{type:Number,value:0},responseHeaders:{type:String,observer:"_computeHasResponseHeaders"},requestHeaders:String,httpMessage:{type:String,observer:"_httpMessageChanged"},hasHttpMessage:{type:Boolean,value:!1,readOnly:!0},responseError:{type:Object,observer:"_computeError"},isError:{type:Boolean,value:!1,readOnly:!0},redirects:{type:Array,value:[],observer:"_redirectsChanged"},redirectTimings:{type:Array,value:function(){return[]}},selectedTab:{type:Number,value:0},timings:{type:Object,notify:!0},hasRedirects:{type:Boolean,value:!1,readOnly:!0},hasResponseHeaders:{type:Boolean,value:!1,readOnly:!0},isXhr:{type:Boolean,value:!1},opened:{type:Boolean,value:!1}},attached:function(){this.statusCode&&this._statusCodeChanged()},_computeStatusClass:function(e){var t="status-code-value";return(e>=500||0===e)&&(t+=" error"),e>=400&&e<500&&(t+=" warning"),e>=300&&e<400&&(t+=" info"),t},_statusCodeChanged:function(){this.statusCode||(this.statusCode=0),this.assignStatusMessage()},_computeIndexName:function(e){return e+1},_handleLink:function(e){e.preventDefault(),e=Polymer.dom(e),"A"===e.rootTarget.nodeName&&this.fire("action-link-change",{url:e.rootTarget.href})},_computeRedirectLocation:function(e){if(!e)return"unknown";var t=e.match(/^location: (.*)$/im);return t?t[1]:"unknown"},_redirectsChanged:function(e){var t=!(!e||!e.length);this._setHasRedirects(t)},_computeError:function(e){this._setIsError(!!e)},_computeHasResponseHeaders:function(e){this._setHasResponseHeaders(!!e)},_computeBageClass:function(e){return"string"==typeof e?e?"badge":"badge empty":0===e?"badge empty":"badge"},_computeHeadersLength:function(e){return e?e.split("\n").length:0},_httpMessageChanged:function(e){var t=!!e;this._setHasHttpMessage(t)},_roundTime:function(e){return e=Number(e),e!==e?"":e.toFixed(2)},toggleCollapse:function(){this.opened=!this.opened},_computeToggleIconClass:function(e){var t="toggle-icon";return e&&(t+=" opened"),t},assignStatusMessage:function(){this.async(function(){if(!this.statusMessage){var e=document.createElement("status-message");e.code=this.statusCode,this.statusMessage=e.message}},100)}});</script>
</dom-module>
</body></html>